(()=>{"use strict";const e=window.React,t=window.wc.wcBlocksRegistry,o=window.wp.htmlEntities,n=window.wc.wcSettings,r=e=>document.querySelector(e),a=(e,t)=>(e?.classList.add(t),e),s=(e,t)=>(e?.classList.remove(t),e),i=e=>(e?.style&&(e.style.display="none"),e);let l={};const c=e=>(l=e,{...d,order:l.order}),d={getOrderInfo:()=>{d.blockOnSubmit(),fetch(l.orderInfoUrl).then(e=>e.json()).then(e=>{l.order=e.message}).catch((e,t,o)=>{console.log(o)}).finally(()=>{d.unblockOnError()})},getPlaceOrderButtonSelector:()=>".wc-block-components-checkout-place-order-button",getSubmitButtonTargetSelector:e=>"#"+e+"-card-submit",getPaymentMethodRadioSelector:e=>'#payment-method input[id*="radio-control-wc-payment-method-options-'+e+'"]',getStoredPaymentMethodsRadioSelector:()=>'#payment-method input[id*="radio-control-wc-payment-method-saved-tokens-"]:checked',isOnlyGatewayMethodDisplayed:e=>{const t=[...document.querySelectorAll('#payment-method input[id*="radio-control-wc-payment-method-"]')];const o=r(d.getPaymentMethodRadioSelector(e));return t.includes(o)&&1===t.length},isFirstPaymentMethod:e=>document.querySelector("#payment-method input").value===e,toggleSubmitButtons:()=>{const e=r('#payment-method input[id*="radio-control-wc-payment-method-options-"]:checked')?.value;if(s(r(".globalpayments.card-submit"),"is-active"),l.hide.includes(e))return void d.hidePlaceOrderButton();if(!l.toggle.includes(e))return void d.showPlaceOrderButton();const t=r("#"+e+"-card-submit"),o=r(d.getStoredPaymentMethodsRadioSelector()),n=e===r(d.getStoredPaymentMethodsRadioSelector()+":checked")?.value;!o||o&&n?(a(t,"is-active"),d.hidePlaceOrderButton()):(i(t),d.showPlaceOrderButton())},hidePlaceOrderButton:()=>{i(a(r(d.getPlaceOrderButtonSelector()),"woocommerce-globalpayments-hidden"))},showPlaceOrderButton:()=>{var e;e=s(r(d.getPlaceOrderButtonSelector()),"woocommerce-globalpayments-hidden"),e?.style&&(e.style.display="")},getFormSelector:()=>"form.wc-block-components-form.wc-block-checkout__form",createInputElement:(e,t,o)=>{let n=document.getElementById(e+"-"+t);n||(n=document.createElement("input"),n.id=e+"-"+t,n.name=e+"["+t+"]",n.type="hidden",r(d.getFormSelector()).appendChild(n)),n.value=o},createSubmitButtonTarget:e=>{const t=document.createElement("div");t.id=d.getSubmitButtonTargetSelector(e).replace("#",""),t.className="globalpayments "+e+" card-submit";const o=r(d.getPlaceOrderButtonSelector());o?.parentNode.insertBefore(t,o.nextSibling),d.toggleSubmitButtons(e)},placeOrder:()=>{try{const e=r(d.getPlaceOrderButtonSelector());if(e)return void e.click()}catch(e){}r(d.getFormSelector()).submit()},showPaymentError:e=>{const t=r(d.getFormSelector());r(".woocommerce-NoticeGroup, .woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-globalpayments-checkout-error")?.remove(),-1===e.indexOf("woocommerce-error")&&(e='<ul class="woocommerce-error"><li>'+e+"</li></ul>"),t?.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout woocommerce-globalpayments-checkout-error">'+e+"</div>"),r("html, body").animate({scrollTop:t.offsetTop-100},1e3),d.unblockOnError(),document.body.dispatchEvent(new Event("checkout_error"))},blockOnSubmit:()=>{const e=r(d.getFormSelector()),t=e.data?.();1!==t?.["blockUI.isBlocked"]&&e.block?.({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblockOnError:()=>{r(d.getFormSelector())?.unblock?.()},hidePaymentMethod:e=>{delete(0,t.getPaymentMethods)()[e],window.wp.data.dispatch(window.wc.wcBlocksData.PAYMENT_STORE_KEY).__internalRemoveAvailablePaymentMethod(e)},setPaymentMethodData:e=>{window.wp.data.dispatch(window.wc.wcBlocksData.PAYMENT_STORE_KEY).__internalSetPaymentMethodData(e)},dispatchInfo:({message:e,context:t="gp-wp-context",cb:o=null})=>{window.wp.data.dispatch("core/notices").createInfoNotice(e,{context:t}),o?.()},dispatchError:({message:e,context:t="gp-wp-context",cb:o=null})=>{window.wp.data.dispatch("core/notices").createErrorNotice(e,{context:t}),o?.()},hasValidationErrors:()=>window.wp.data.select(window.wc.wcBlocksData.VALIDATION_STORE_KEY).hasValidationErrors()},{__}=wp.i18n,{__:m}=wp.i18n,p=({state:e,helper:t,dispatchError:o,placeOrder:n})=>{var r;t.blockOnSubmit(),e.settings.helper_params.order=t.order;const a=e.tokenResponse?JSON.stringify(e.tokenResponse):null,s=null!==(r=document.querySelector(t.getStoredPaymentMethodsRadioSelector())?.value)&&void 0!==r?r:"new";return GlobalPayments.ThreeDSecure.checkVersion(e.threedsecure.checkEnrollmentUrl,{tokenResponse:a,wcTokenId:s,order:{id:e.settings.helper_params.order.id,amount:e.settings.helper_params.order.amount,currency:e.settings.helper_params.order.currency}}).then(r=>{if(r.error)return o(r.message),!1;if("NOT_ENROLLED"===r.status&&"YES"!==r.liabilityShift)return o("Please try again with another card."),!1;if("NOT_ENROLLED"===r.status&&"YES"===r.liabilityShift)return n(),!0;const i=!document.querySelector('.wc-block-checkout__use-address-for-billing input[type="checkbox"]')?.checked,l={streetAddress1:document.querySelector("#billing-address_1")?.value,streetAddress2:document.querySelector("#billing-address_2")?.value,city:document.querySelector("#billing-city")?.value,state:document.querySelector("#billing-state input")?.value,postalCode:document.querySelector("#billing-postcode")?.value,country:document.querySelector("#billing-country input")?.value},c=i?l:{streetAddress1:document.querySelector("#shipping-address_1")?.value,streetAddress2:document.querySelector("#shipping-address_2")?.value,city:document.querySelector("#shipping-city")?.value,state:document.querySelector("#shipping-state input")?.value,postalCode:document.querySelector("#shipping-postcode")?.value,country:document.querySelector("#shipping-country input")?.value};GlobalPayments.ThreeDSecure.initiateAuthentication(e.threedsecure.initiateAuthenticationUrl,{tokenResponse:a,wcTokenId:s,versionCheckData:r,challengeWindow:{windowSize:GlobalPayments.ThreeDSecure.ChallengeWindowSize.Windowed500x600,displayMode:"lightbox"},order:{id:e.settings.helper_params.order.id,amount:e.settings.helper_params.order.amount,currency:e.settings.helper_params.order.currency,billingAddress:l,shippingAddress:c,addressMatchIndicator:i,customerEmail:document.querySelector(".wc-block-components-address-form__email input#email").value}}).then(a=>{if(a.error)return o(a.message),!1;const s=a.serverTransactionId||a.challenge.response.data.threeDSServerTransID||r.serverTransactionId;return t.createInputElement(e.settings.id,"serverTransId",s),e.serverTransId=s,n(),!0}).catch(e=>(console.error(e),console.error(e.reasons),o("Something went wrong while doing 3DS processing."),!1))}).catch(e=>(console.error(e),console.error(e.reasons),o("Something went wrong while doing 3DS processing."),!1)),document.addEventListener("click",e=>{e.target.matches('img[id^="GlobalPayments-frame-close-"]')&&window.parent.postMessage({data:{transStatus:"N"},event:"challengeNotification"},window.location.origin)}),!1},u={settings:null,cardForm:null,tokenResponse:null,fieldOptions:null,serverTransId:null};let g={};const y=t=>{const{id:o,eventRegistration:r}=t,a=(0,n.getSetting)(o+"_data",{}),s=Object.entries(a.secure_payment_fields),{StoreNoticesContainer:i}=window.wc.blocksCheckout;g=c(a.helper_params),u.settings=a,u.fieldOptions=a.secure_payment_fields,u.threedsecure=a.threedsecure;const{onCheckoutFail:l}=r;return(0,e.useEffect)(()=>{w();const e=l(()=>{k(),f()});return()=>{document.querySelector(g.getPaymentMethodRadioSelector(u.settings.id))?.checked||(document.querySelector(g.getSubmitButtonTargetSelector(u.settings.id))?.remove(),g.showPlaceOrderButton()),e()}},[l]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{dangerouslySetInnerHTML:{__html:u.settings.environment_indicator}}),s.map(t=>(0,e.createElement)(h,{id:o,field:t[1],key:t[0]})),(0,e.createElement)(i,{context:"gp-wp-context"}))},h=t=>{const{id:o,field:n}=t;return(0,e.createElement)("div",{className:`globalpayments ${o} ${n.class}`},(0,e.createElement)("label",{htmlFor:`${o}-${n.class}`},n.label,(0,e.createElement)("span",{className:"required"},"*")),(0,e.createElement)("div",{id:`${o}-${n.class}`}))};var S=0,b=!1;const w=()=>{document.querySelector("#order_review, #add_payment_method")?.addEventListener("click",e=>{e.target.matches('#payment-method input[type="radio"]')&&g.toggleSubmitButtons()}),document.body.addEventListener("checkout_error",()=>{document.querySelector("#globalpayments_gpapi-serverTransId")?.remove()}),document.addEventListener("globalpayments_pay_order_modal_loaded",_),document.addEventListener("globalpayments_pay_order_modal_error",(e,t)=>{g.showPaymentError(t)});const e=()=>{_(),b||(setTimeout(()=>{b||_()},500),setTimeout(()=>{b||_()},1e3))};(g.isFirstPaymentMethod(u.settings.id)||g.isOnlyGatewayMethodDisplayed(u.settings.id))&&("loading"===document.readyState?(document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e)):"interactive"===document.readyState?(setTimeout(e,100),window.addEventListener("load",e)):e());const t=document.querySelector("#radio-control-wc-payment-method-options-globalpayments_gpapi"),o=()=>{console.log("Payment method changed to GlobalPayments"),b=!1,S=0,_()};t?t.addEventListener("change",o):setTimeout(()=>{const e=document.querySelector("#radio-control-wc-payment-method-options-globalpayments_gpapi");e&&e.addEventListener("change",o)},500)},_=()=>{if(b&&u.cardForm)return void console.log("GlobalPayments form is already initialized, skipping...");if(S>=20)return console.error("Maximum retry attempts reached. GlobalPayments form initialization failed."),void P("Payment form could not be loaded. Please refresh the page and try again.");const e=u.settings.gateway_options;e.error&&P(e.message),document.querySelector(g.getSubmitButtonTargetSelector(u.settings.id))||g.createSubmitButtonTarget(u.settings.id);const t=GlobalPayments;t.configure(e),t.on("error",O),u.cardForm=t.ui.form({fields:q(),styles:M()}),u.cardForm.on("submit","click",()=>{v(),E(),g.blockOnSubmit()}),u.cardForm.on("token-success",A),u.cardForm.on("token-error",O),u.cardForm.on("error",O),u.cardForm.on("card-form-validity",e=>{e||(g.unblockOnError(),f(),k())}),u.cardForm.ready(()=>{g.toggleSubmitButtons()})},v=()=>{const e=document.querySelector(g.getSubmitButtonTargetSelector(u.settings.id));e.classList.add("wc-block-components-spinner"),e.classList.add("wc-block-components-checkout-step--disabled"),e.style.height="initial !important",e.style.width="initial !important",e.style.position="relative"},f=()=>{const e=document.querySelector(g.getSubmitButtonTargetSelector(u.settings.id));e.classList.remove("wc-block-components-spinner"),e.classList.remove("wc-block-components-checkout-step--disabled"),e.style.height="initial !important",e.style.width="initial !important",e.style.position="relative"},E=()=>{document.querySelector(g.getFormSelector()).classList.add("wc-block-components-checkout-step--disabled"),document.querySelectorAll(`${g.getFormSelector()} > *`).forEach(e=>{e.style.pointerEvents="none"})},k=()=>{document.querySelector(g.getFormSelector()).classList.remove("wc-block-components-checkout-step--disabled"),document.querySelectorAll(`${g.getFormSelector()} > *`).forEach(e=>{e.style.pointerEvents=""})},P=e=>{g.dispatchError({message:e,cb:()=>{f(),k()}})},T=e=>{P(u.settings.secure_payment_fields[e].messages.validation),g.unblockOnError()},O=e=>{if(e.reasons)for(let t=0;t<e.reasons.length;t++){const o=e.reasons[t];"NOT_AUTHENTICATED"===o.code?P("We're not able to process this payment. Please refresh the page and try again."):P(o.message)}else P("Something went wrong. Please contact us to get assistance.")},q=()=>{const e={"card-number":{placeholder:u.fieldOptions["card-number-field"].placeholder,target:"#"+u.settings.id+"-"+u.fieldOptions["card-number-field"].class},"card-expiration":{placeholder:u.fieldOptions["card-expiry-field"].placeholder,target:"#"+u.settings.id+"-"+u.fieldOptions["card-expiry-field"].class},"card-cvv":{placeholder:u.fieldOptions["card-cvc-field"].placeholder,target:"#"+u.settings.id+"-"+u.fieldOptions["card-cvc-field"].class},submit:{text:C(),target:"#"+u.settings.id+"-card-submit"}};return u.fieldOptions.hasOwnProperty("card-holder-name-field")&&(e["card-holder-name"]={placeholder:u.fieldOptions["card-holder-name-field"].placeholder,target:"#"+u.settings.id+"-"+u.fieldOptions["card-holder-name-field"].class}),e},C=()=>document.querySelector(g.getPlaceOrderButtonSelector()).innerText,M=()=>JSON.parse(u.settings.field_styles),A=e=>{if(g.hasValidationErrors())return f(),k(),window.wp.data.dispatch(window.wc.wcBlocksData.VALIDATION_STORE_KEY).showAllValidationErrors(),void document.querySelector(".has-error")?.scrollIntoView({behavior:"smooth",block:"center",inline:"start"});D(e)&&(u.tokenResponse=e,B())},B=()=>{u.settings.gateway_options.enableThreeDSecure?(g.getOrderInfo(),p({state:u,helper:g,dispatchError:P,placeOrder:I})):I()},I=()=>{"function"==typeof u.cardForm.frames["card-cvv"].getCvv?u.cardForm.frames["card-cvv"].getCvv().then(e=>{u.tokenResponse&&(u.tokenResponse.details.cardSecurityCode=e),L()}):L()},D=e=>{if(e.details){const t=new Date(e.details.expiryYear,e.details.expiryMonth-1),o=new Date,n=new Date(o.getFullYear(),o.getMonth());if(!e.details.expiryYear||!e.details.expiryMonth||t<n)return T("card-expiry-field"),!1}return!(e.details&&!e.details.cardSecurityCode&&(T("card-cvc-field"),1))},L=()=>{const e={token_response:JSON.stringify(u.tokenResponse)};u.serverTransId&&(e.serverTransId=u.serverTransId),g.setPaymentMethodData(e),g.placeOrder()},{__:N}=wp.i18n,F={order:null,settings:null};let R={};const x=()=>{R.toggleSubmitButtons(),G()},G=()=>{R.createSubmitButtonTarget(F.settings.id);const e=document.createElement("div");e.className="apple-pay-button apple-pay-button-"+F.settings.payment_method_options.button_color,e.title=N("Pay with Apple Pay","globalpayments-gateway-provider-for-woocommerce"),e.alt=N("Pay with Apple Pay","globalpayments-gateway-provider-for-woocommerce"),e.id=F.settings.id,e.addEventListener("click",e=>{if(e.preventDefault(),R.hasValidationErrors())return window.wp.data.dispatch(window.wc.wcBlocksData.VALIDATION_STORE_KEY).showAllValidationErrors(),void document.querySelector(".has-error")?.scrollIntoView({behavior:"smooth",block:"center",inline:"start"});V().begin()}),document.querySelector(R.getSubmitButtonTargetSelector(F.settings.id)).append(e)},V=()=>{R.getOrderInfo(),F.order=R.order;let e=null;try{e=new ApplePaySession(1,H())}catch(e){return console.error(N("Unable to create ApplePaySession","globalpayments-gateway-provider-for-woocommerce"),e),alert(N("We're unable to take your payment through Apple Pay. Please try again or use an alternative payment method.","globalpayments-gateway-provider-for-woocommerce")),!1}return e.onvalidatemerchant=t=>{W(t,e)},e.onpaymentauthorized=t=>{K(t,e)},e.oncancel=e=>{alert(N("We're unable to take your payment through Apple Pay. Please try again or use an alternative payment method.","globalpayments-gateway-provider-for-woocommerce"))},e},H=()=>({countryCode:U(),currencyCode:F.order.currency,merchantCapabilities:["supports3DS"],supportedNetworks:Y(),total:{label:$(),amount:F.order.amount.toString()},requiredBillingContactFields:["postalAddress","name"]}),U=()=>F.settings.payment_method_options.country_code,Y=()=>F.settings.payment_method_options.cc_types,$=()=>F.settings.payment_method_options.apple_merchant_display_name,W=(e,t)=>{fetch(F.settings.payment_method_options.validate_merchant_url,{cache:"no-store",body:JSON.stringify({validationUrl:e.validationURL}),method:"POST"}).then(e=>e.json()).then(e=>{e.error?(console.log("response",e),t.abort(),alert(N("We're unable to take your payment through Apple Pay. Please try again or use an alternative payment method.","globalpayments-gateway-provider-for-woocommerce"))):t.completeMerchantValidation(JSON.parse(e.message))}).catch(e=>{console.log("response",e),t.abort(),alert(N("We're unable to take your payment through Apple Pay. Please try again or use an alternative payment method.","globalpayments-gateway-provider-for-woocommerce"))})},K=(e,t)=>{try{const o={dw_token:JSON.stringify(e.payment.token.paymentData)};e.payment.billingContact&&(o.cardHolderName=e.payment.billingContact.givenName+" "+e.payment.billingContact.familyName),R.setPaymentMethodData(o);const n=document.querySelector(R.getPlaceOrderButtonSelector());if(n)return n.click(),void t.completePayment(ApplePaySession.STATUS_SUCCESS)}catch(e){t.completePayment(ApplePaySession.STATUS_FAILURE)}t.completePayment(ApplePaySession.STATUS_SUCCESS),document.querySelector(R.getFormSelector()).submit()},{__:J}=wp.i18n,j={order:null,ctpForm:null,settings:null};let z={};const Q=()=>{if(z.toggleSubmitButtons(),X(),!GlobalPayments.configure)return void console.log(J("Warning! Payment fields cannot be loaded","globalpayments-gateway-provider-for-woocommerce"));const e=j.settings.payment_method_options;z.getOrderInfo(),j.order=z.order,e.apms.currencyCode=j.order.currency,GlobalPayments.configure(e),GlobalPayments.on("error",Z),j.ctpForm=GlobalPayments.apm.form("#"+j.settings.id,{amount:j.order.amount.toString(),style:"gp-default",apms:[GlobalPayments.enums.Apm.ClickToPay]}),j.ctpForm.on("token-success",ee),j.ctpForm.on("token-error",Z),j.ctpForm.on("error",Z)},X=()=>{const e=document.querySelector("#"+j.settings.id);if(e?.children.length>0){for(;e.firstChild;)e.removeChild(e.lastChild);document.querySelector("#"+j.settings.id+"-dw_token")?.remove()}},Z=e=>{console.error(e)},ee=e=>(z.setPaymentMethodData({dw_token:e.paymentReference}),z.placeOrder()),te={order:null,settings:null,paymentsClient:null};let oe={};const ne=()=>{re(),te.paymentsClient.isReadyToPay(se()).then(e=>{e.result?me(te.settings.id):(oe.hidePaymentMethod(te.settings.id),oe.hidePlaceOrderButton())}).catch(console.error)},re=()=>{null===te.paymentsClient&&(te.paymentsClient=new google.payments.api.PaymentsClient({environment:ae()}))},ae=()=>te.settings.payment_method_options.env,se=()=>Object.assign({},ie(),{allowedPaymentMethods:[le()]}),ie=()=>({apiVersion:2,apiVersionMinor:0}),le=()=>({type:"CARD",parameters:{allowedAuthMethods:ce(),allowedCardNetworks:de(),billingAddressRequired:!0}}),ce=()=>te.settings.payment_method_options.aca_methods,de=()=>te.settings.payment_method_options.cc_types,me=()=>{oe.createSubmitButtonTarget(te.settings.id);const e=te.paymentsClient.createButton({buttonColor:pe(),onClick:()=>{ue()}});document.querySelector(oe.getSubmitButtonTargetSelector(te.settings.id)).append(e)},pe=()=>te.settings.payment_method_options.button_color,ue=()=>{if(oe.hasValidationErrors())return window.wp.data.dispatch(window.wc.wcBlocksData.VALIDATION_STORE_KEY).showAllValidationErrors(),void document.querySelector(".has-error")?.scrollIntoView({behavior:"smooth",block:"center",inline:"start"});oe.getOrderInfo(),te.order=oe.order;const e=ge();te.paymentsClient.loadPaymentData(e).then(e=>(oe.setPaymentMethodData({dw_token:JSON.stringify(JSON.parse(e.paymentMethodData.tokenizationData.token)),cardHolderName:e.paymentMethodData.info.billingAddress.name}),oe.placeOrder())).catch(console.error)},ge=()=>{const e=Object.assign({},ie());return e.allowedPaymentMethods=[ye()],e.transactionInfo=Se(),e.merchantInfo={merchantId:be(),merchantName:we()},e},ye=()=>Object.assign({},le(),{tokenizationSpecification:he()}),he=()=>({type:"PAYMENT_GATEWAY",parameters:{gateway:"globalpayments",gatewayMerchantId:te.settings.payment_method_options.global_payments_merchant_id}}),Se=()=>({totalPriceStatus:"FINAL",totalPrice:te.order.amount.toString(),currencyCode:te.order.currency}),be=()=>te.settings.payment_method_options.google_merchant_id,we=()=>te.settings.payment_method_options.google_merchant_name,_e={settings:null,onSubmit:null,serverTransId:""};let ve={};const fe=()=>{document.querySelector("#wc-block-components-spinner")?.remove()},Ee=()=>{document.querySelector(ve.getFormSelector()).classList.remove("wc-block-components-checkout-step--disabled"),document.querySelectorAll(`${ve.getFormSelector()} > *`).forEach(e=>{e.style.pointerEvents=""})},ke=e=>{ve.dispatchError({message:e,cb:()=>{fe(),Ee()}})},Pe=()=>{if(ve.hasValidationErrors())return fe(),Ee(),void document.querySelector(".has-error").scrollIntoView({behavior:"smooth",block:"center",inline:"start"});_e.settings.gateway_options.enableThreeDSecure?(ve.getOrderInfo(),(()=>{const e=document.querySelector(ve.getPlaceOrderButtonSelector()),t=document.createElement("span");t.id="wc-block-components-spinner",t.classList.add("wc-block-components-spinner"),e.appendChild(t)})(),document.querySelector(ve.getFormSelector()).classList.add("wc-block-components-checkout-step--disabled"),document.querySelectorAll(`${ve.getFormSelector()} > *`).forEach(e=>{e.style.pointerEvents="none"}),p({state:_e,helper:ve,dispatchError:ke,placeOrder:()=>{const e=window.wp.data.select(window.wc.wcBlocksData.PAYMENT_STORE_KEY).getPaymentMethodData();e.serverTransId=_e.serverTransId,ve.setPaymentMethodData(e),_e.onSubmit()}})):_e.onSubmit()},{__:Te}=wp.i18n,Oe=({billing:t,shippingData:o,setValidationErrors:n,clearValidationErrors:r,onSubmit:a,activePaymentMethod:s,eventRegistration:i,emitResponse:l,enableThreeDSecure:c,hpp_nonce:d,gateway_id:m,hpp_text:p,environment_indicator:u,...g})=>{const{onPaymentSetup:y,onCheckoutValidation:h}=i||{},S=(0,e.useMemo)(()=>t?.billingAddress?.country,[t?.billingAddress?.country]),b=(0,e.useMemo)(()=>o?.shippingAddress?.country,[o?.shippingAddress?.country]),w=(0,e.useMemo)(()=>"GB"===S||"GB"===b,[S,b]),_=(0,e.useMemo)(()=>({enableThreeDSecure:c,billingCountry:S,shippingCountry:b,isGBAddress:w,billingPhone:t?.billingAddress?.phone,billingState:t?.billingAddress?.state,shippingState:o?.shippingAddress?.state,needsShipping:o?.needsShipping}),[c,S,b,w,t?.billingAddress?.phone,t?.billingAddress?.state,o?.shippingAddress?.state,o?.needsShipping]);return(0,e.useEffect)(()=>{if(r)try{r()}catch(e){console.warn("GlobalPayments HPP: Failed to clear validation errors:",e)}},[r]),(0,e.useEffect)(()=>{const e=new Map,t='input[id*="phone"], input[name*="phone"]',o='input[id*="state"], select[id*="state"], input[name*="state"], select[name*="state"]',n='input[name="radio-control-wc-payment-method-options"]',r=t=>{e.has(t)||e.set(t,{type:"innerHTML",value:t.innerHTML})},a=t=>{e.has(t)||r(t),(e=>{e.textContent.includes("(optional)")&&(e.innerHTML=e.innerHTML.replace(/\s*\(optional\)\s*/gi,"")),e.querySelectorAll("*").forEach(e=>{e.textContent.toLowerCase().includes("optional")&&(e.innerHTML=e.innerHTML.replace(/\s*\(optional\)\s*/gi,""))})})(t)},s=(e,t)=>{if(!t)return;e.setAttribute("required","required"),e.setAttribute("aria-required","true"),document.querySelectorAll(`label[for="${e.id}"]`).forEach(e=>{a(e),(e=>{if(!e.querySelector(".gp-required-asterisk")){const t=document.createElement("span");t.className="gp-required-asterisk",t.textContent=" *",t.style.cssText="color: #e2401c; font-weight: bold;",e.appendChild(t)}})(e)});const o=e.id||e.name;if(o){const e=document.querySelector(`#validate-error-${o}`);e&&a(e)}let n=e.parentElement;for(;n&&!n.classList.contains("wc-block-checkout__form");)n.querySelectorAll(".wc-block-components-checkout-step__description").forEach(e=>{e.textContent.toLowerCase().includes("optional")&&(r(e),e.style.display="none")}),n=n.parentElement},i=()=>{c&&document.querySelectorAll(t).forEach(e=>{s(e,!0)}),w&&document.querySelectorAll(o).forEach(e=>{s(e,!0)})},l=()=>{e.forEach((e,t)=>{t&&t.parentNode&&("innerHTML"===e.type?t.innerHTML=e.value:"display"===e.type&&(t.style.display=e.value))}),e.clear(),document.querySelectorAll(`${t}, ${o}`).forEach(e=>{e.removeAttribute("required"),e.removeAttribute("aria-required")}),document.querySelectorAll(".gp-required-asterisk").forEach(e=>{e.remove()})};i();const d=setTimeout(i,800),m=new MutationObserver(e=>{let r=!1;for(const a of e)if("childList"===a.type&&a.addedNodes.length>0)for(const e of a.addedNodes)e.nodeType===Node.ELEMENT_NODE&&e.querySelector&&(e.querySelector(`${t}, ${o}`)&&(r=!0),e.querySelectorAll(n).forEach(e=>{e.addEventListener("change",p)}));r&&setTimeout(i,100)});m.observe(document.body,{childList:!0,subtree:!0});const p=e=>{let t;try{t=window.wp?.data?.select("wc/store/payment")?.getActivePaymentMethod()}catch(e){console.warn("GlobalPayments HPP: Payment Store access failed:",e)}const o=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked')?.value,n=t||o;n&&!n.includes("globalpayments")?l():setTimeout(i,100)},u=document.querySelectorAll(n);return u.forEach(e=>{e.addEventListener("change",p)}),()=>{clearTimeout(d),m.disconnect(),u.forEach(e=>{e.removeEventListener("change",p)}),l()}},[c,w]),(0,e.useEffect)(()=>{if(h)return h(()=>{const e=[];return _.enableThreeDSecure&&((_.billingPhone||"").trim()||e.push({errorId:"billing_phone_required",message:Te("Billing phone number is required for secure payments.","globalpayments-gateway-provider-for-woocommerce"),validationErrorId:"billing_phone"})),"GB"!==_.billingCountry||(_.billingState||"").trim()||e.push({errorId:"billing_state_required_gb",message:Te("County is required for UK billing addresses.","globalpayments-gateway-provider-for-woocommerce"),validationErrorId:"billing_state"}),"GB"===_.shippingCountry&&_.needsShipping&&!(_.shippingState||"").trim()&&e.push({errorId:"shipping_state_required_gb",message:Te("County is required for UK shipping addresses.","globalpayments-gateway-provider-for-woocommerce"),validationErrorId:"shipping_state"}),!(e.length>0)||e})},[h,_]),(0,e.useEffect)(()=>y(()=>({type:l.responseTypes.SUCCESS,meta:{paymentMethodData:{payment_method:s||"globalpayments_gpapi",payment_interface:"hpp",gp_hpp_nonce:d||"",gateway_id:m||"globalpayments_gpapi",checkout_validated:"1"}}})),[y,l.responseTypes,d,m,s]),(0,e.createElement)("div",{className:"gp-hpp-payment-method"},u&&(0,e.createElement)("div",{dangerouslySetInnerHTML:{__html:u}}),(0,e.createElement)("div",{className:"gp-hpp-description"},(0,e.createElement)("p",null,p||Te("Pay With Credit / Debit Card Via Globalpayments","globalpayments-gateway-provider-for-woocommerce"))))};Oe.displayName="Globalpayments.HppComponent";const{__:qe}=wp.i18n,Ce=[{id:"globalpayments_gpapi",Content:(0,e.createElement)(t=>{const o=(0,n.getSetting)("globalpayments_gpapi_data",{}),r=o.helper_params?.payment_interface||o.payment_interface,a=o.helper_params?.hpp_nonce||o.hpp_nonce,s=o.helper_params?.hpp_text||o.hpp_text,i=o.helper_params?.enableThreeDSecure||o.enableThreeDSecure;if("hpp"===r){const n={...t,hpp_nonce:a,hpp_text:s||qe("Pay With Credit / Debit Card Via Globalpayments","globalpayments-gateway-provider-for-woocommerce"),gateway_id:"globalpayments_gpapi",payment_interface:"hpp",environment_indicator:o.environment_indicator||"",enableThreeDSecure:i||!1};return(0,e.createElement)(Oe,{...n})}return(0,e.createElement)(y,{id:"globalpayments_gpapi",...t})},null),SavedTokenComponent:(0,e.createElement)(t=>{const{id:o,onSubmit:r,eventRegistration:a}=t;_e.onSubmit=r;const s=(0,n.getSetting)(o+"_data",{});ve=c(s.helper_params),_e.settings=s,_e.threedsecure=s.threedsecure;const{onCheckoutFail:i}=a;(0,e.useEffect)(()=>{window.onload=()=>{document.querySelector(ve.getPlaceOrderButtonSelector()).addEventListener("click",e=>{document.querySelector(ve.getStoredPaymentMethodsRadioSelector())&&(e.preventDefault(),e.stopImmediatePropagation(),Pe())})};const e=i(()=>{Ee(),fe()});return()=>{e()}},[i]);const{StoreNoticesContainer:l}=window.wc.blocksCheckout;return(0,e.createElement)(l,{context:"gp-wp-context"})},{id:"globalpayments_gpapi"}),canMakePayment:e=>!e.gateway_options.hide||!e.gateway_options.error||(console.error(e.gateway_options.message),!1)},{id:"globalpayments_clicktopay",Content:(0,e.createElement)(()=>(j.settings=(0,n.getSetting)("globalpayments_clicktopay_data",{}),z=c(j.settings.helper_params),(0,e.useEffect)(()=>((z.isFirstPaymentMethod(j.settings.id)||z.isOnlyGatewayMethodDisplayed(j.settings.id))&&(window.onload=()=>{Q()}),document.querySelector("#radio-control-wc-payment-method-options-globalpayments_clicktopay").addEventListener("change",Q),()=>{document.querySelector(z.getPaymentMethodRadioSelector(j.settings.id))?.checked||z.toggleSubmitButtons()})),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{id:j.settings.id}))),null),SavedTokenComponent:null,canMakePayment:e=>!e.payment_method_options.error||(console.error(e.payment_method_options.message),!1)},{id:"globalpayments_googlepay",Content:(0,e.createElement)(t=>{const{eventRegistration:o}=t;te.settings=(0,n.getSetting)("globalpayments_googlepay_data",{}),oe=c(te.settings.helper_params);const{onCheckoutFail:r}=o;(0,e.useEffect)(()=>{(oe.isFirstPaymentMethod(te.settings.id)||oe.isOnlyGatewayMethodDisplayed(te.settings.id))&&(window.onload=()=>{ne()}),document.querySelector("#radio-control-wc-payment-method-options-globalpayments_googlepay").addEventListener("change",ne);const e=r(()=>{document.querySelector(".is-error")?.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})});return()=>{document.querySelector(oe.getPaymentMethodRadioSelector(te.settings.id))?.checked||(document.querySelector(oe.getSubmitButtonTargetSelector(te.settings.id))?.remove(),oe.toggleSubmitButtons()),e()}},[r])},null),SavedTokenComponent:null,canMakePayment:()=>!0},{id:"globalpayments_applepay",Content:(0,e.createElement)(()=>{F.settings=(0,n.getSetting)("globalpayments_applepay_data",{}),R=c(F.settings.helper_params),(0,e.useEffect)(()=>((R.isFirstPaymentMethod(F.settings.id)||R.isOnlyGatewayMethodDisplayed(F.settings.id))&&(window.onload=()=>{x()}),document.querySelector("#radio-control-wc-payment-method-options-globalpayments_applepay").addEventListener("change",x),()=>{document.querySelector(R.getPaymentMethodRadioSelector(F.settings.id))?.checked||(document.querySelector(R.getSubmitButtonTargetSelector(F.settings.id))?.remove(),R.toggleSubmitButtons())}))},null),SavedTokenComponent:null,canMakePayment:()=>"https:"!==location.protocol?(console.warn(qe("Apple Pay requires your checkout be served over HTTPS","globalpayments-gateway-provider-for-woocommerce")),!1):!0===(window.ApplePaySession&&ApplePaySession.canMakePayments())||(console.warn(qe("Apple Pay is not supported on this device/browser","globalpayments-gateway-provider-for-woocommerce")),!1)},{id:"globalpayments_affirm",Content:(0,e.createElement)(t=>{const{id:o,eventRegistration:r}=t,{onPaymentSetup:a}=r,s=(0,n.getSetting)(o+"_data",{});c(s.helper_params).showPlaceOrderButton(),(0,e.useEffect)(()=>{const e=a(()=>{const e=document.getElementById("shipping-phone"),t=document.getElementById("billing-phone");return!(!e?.value&&!t?.value)||{type:"error",message:m("<strong>Phone</strong> is a required field for this payment method.","globalpayments-gateway-provider-for-woocommerce")}});return()=>{e()}},[a])},{id:"globalpayments_affirm"}),SavedTokenComponent:null,canMakePayment:()=>!0},{id:"globalpayments_klarna",Content:(0,e.createElement)(t=>{const{id:o,eventRegistration:r}=t,{onPaymentSetup:a}=r,s=(0,n.getSetting)(o+"_data",{});c(s.helper_params).showPlaceOrderButton(),(0,e.useEffect)(()=>{const e=a(()=>{const e=document.getElementById("shipping-phone"),t=document.getElementById("billing-phone");return!(!e?.value&&!t?.value)||{type:"error",message:__("<strong>Phone</strong> is a required field for this payment method.","globalpayments-gateway-provider-for-woocommerce")}});return()=>{e()}},[a])},{id:"globalpayments_klarna"}),SavedTokenComponent:null,canMakePayment:()=>!0},{id:"globalpayments_bankpayment",Content:(0,e.createElement)(({id:e})=>{const t=(0,n.getSetting)(e+"_data",{});c(t.helper_params).showPlaceOrderButton()},{id:"globalpayments_bankpayment"}),SavedTokenComponent:null,canMakePayment:()=>!0},{id:"globalpayments_paypal",Content:(0,e.createElement)(({id:e})=>{const t=(0,n.getSetting)(e+"_data",{});c(t.helper_params).showPlaceOrderButton()},{id:"globalpayments_paypal"}),SavedTokenComponent:null,canMakePayment:()=>!0}],Me=(0,t.getPaymentMethods)();Ce.forEach(r=>{Me.hasOwnProperty(r.id)||(r=>{const{id:a,Content:s,SavedTokenComponent:i,canMakePayment:l}=r,c=(0,n.getSetting)(a+"_data",{});if(0===Object.entries(c).length)return;const d=(0,o.decodeEntities)(c.title),m={name:a,label:(0,e.createElement)(t=>{const{PaymentMethodLabel:o}=t.components;return(0,e.createElement)(o,{text:d})},null),content:s,edit:s,savedTokenComponent:i,canMakePayment:()=>l(c),ariaLabel:d,supports:{features:c.supports,showSaveOption:c.allow_card_saving}};(0,t.registerPaymentMethod)(m)})(r)})})();