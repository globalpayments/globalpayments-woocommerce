(()=>{"use strict";const e=window.wc.wcBlocksRegistry,t=window.wp.htmlEntities,o=window.wc.wcSettings,n=window.ReactJSXRuntime,r=e=>document.querySelector(e),a=(e,t)=>(e?.classList.add(t),e),s=(e,t)=>(e?.classList.remove(t),e),i=e=>(e?.style&&(e.style.display="none"),e);let l={};const c=e=>(l=e,{...d,order:l.order}),d={getOrderInfo:()=>{d.blockOnSubmit(),fetch(l.orderInfoUrl).then(e=>e.json()).then(e=>{l.order=e.message}).catch((e,t,o)=>{console.log(o)}).finally(()=>{d.unblockOnError()})},getPlaceOrderButtonSelector:()=>".wc-block-components-checkout-place-order-button",getSubmitButtonTargetSelector:e=>"#"+e+"-card-submit",getPaymentMethodRadioSelector:e=>'#payment-method input[id*="radio-control-wc-payment-method-options-'+e+'"]',getStoredPaymentMethodsRadioSelector:()=>'#payment-method input[id*="radio-control-wc-payment-method-saved-tokens-"]:checked',isOnlyGatewayMethodDisplayed:e=>{const t=[...document.querySelectorAll('#payment-method input[id*="radio-control-wc-payment-method-"]')];const o=r(d.getPaymentMethodRadioSelector(e));return t.includes(o)&&1===t.length},isFirstPaymentMethod:e=>document.querySelector("#payment-method input").value===e,toggleSubmitButtons:()=>{const e=r('#payment-method input[id*="radio-control-wc-payment-method-options-"]:checked')?.value;if(s(r(".globalpayments.card-submit"),"is-active"),l.hide.includes(e))return void d.hidePlaceOrderButton();if(!l.toggle.includes(e))return void d.showPlaceOrderButton();const t=r("#"+e+"-card-submit"),o=r(d.getStoredPaymentMethodsRadioSelector()),n=e===r(d.getStoredPaymentMethodsRadioSelector()+":checked")?.value;!o||o&&n?(a(t,"is-active"),d.hidePlaceOrderButton()):(i(t),d.showPlaceOrderButton())},hidePlaceOrderButton:()=>{i(a(r(d.getPlaceOrderButtonSelector()),"woocommerce-globalpayments-hidden"))},showPlaceOrderButton:()=>{var e;e=s(r(d.getPlaceOrderButtonSelector()),"woocommerce-globalpayments-hidden"),e?.style&&(e.style.display="")},getFormSelector:()=>"form.wc-block-components-form.wc-block-checkout__form",createInputElement:(e,t,o)=>{let n=document.getElementById(e+"-"+t);n||(n=document.createElement("input"),n.id=e+"-"+t,n.name=e+"["+t+"]",n.type="hidden",r(d.getFormSelector()).appendChild(n)),n.value=o},createSubmitButtonTarget:e=>{const t=document.createElement("div");t.id=d.getSubmitButtonTargetSelector(e).replace("#",""),t.className="globalpayments "+e+" card-submit";const o=r(d.getPlaceOrderButtonSelector());o?.parentNode.insertBefore(t,o.nextSibling),d.toggleSubmitButtons(e)},placeOrder:()=>{try{const e=r(d.getPlaceOrderButtonSelector());if(e)return void e.click()}catch(e){}r(d.getFormSelector()).submit()},showPaymentError:e=>{const t=r(d.getFormSelector());r(".woocommerce-NoticeGroup, .woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-globalpayments-checkout-error")?.remove(),-1===e.indexOf("woocommerce-error")&&(e='<ul class="woocommerce-error"><li>'+e+"</li></ul>"),t?.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout woocommerce-globalpayments-checkout-error">'+e+"</div>"),r("html, body").animate({scrollTop:t.offsetTop-100},1e3),d.unblockOnError(),document.body.dispatchEvent(new Event("checkout_error"))},blockOnSubmit:()=>{const e=r(d.getFormSelector()),t=e.data?.();1!==t?.["blockUI.isBlocked"]&&e.block?.({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblockOnError:()=>{r(d.getFormSelector())?.unblock?.()},hidePaymentMethod:t=>{delete(0,e.getPaymentMethods)()[t],window.wp.data.dispatch(window.wc.wcBlocksData.PAYMENT_STORE_KEY).__internalRemoveAvailablePaymentMethod(t)},setPaymentMethodData:e=>{window.wp.data.dispatch(window.wc.wcBlocksData.PAYMENT_STORE_KEY).__internalSetPaymentMethodData(e)},dispatchInfo:({message:e,context:t="gp-wp-context",cb:o=null})=>{window.wp.data.dispatch("core/notices").createInfoNotice(e,{context:t}),o?.()},dispatchError:({message:e,context:t="gp-wp-context",cb:o=null})=>{window.wp.data.dispatch("core/notices").createErrorNotice(e,{context:t}),o?.()},hasValidationErrors:()=>window.wp.data.select(window.wc.wcBlocksData.VALIDATION_STORE_KEY).hasValidationErrors()},m=window.React,{__}=wp.i18n,{__:p}=wp.i18n,u=e=>{const{id:t,eventRegistration:n}=e,{onPaymentSetup:r}=n,a=(0,o.getSetting)(t+"_data",{});c(a.helper_params).showPlaceOrderButton(),(0,m.useEffect)(()=>{const e=r(()=>{const e=document.getElementById("shipping-phone"),t=document.getElementById("billing-phone");return!(!e?.value&&!t?.value)||{type:"error",message:p("<strong>Phone</strong> is a required field for this payment method.","globalpayments-gateway-provider-for-woocommerce")}});return()=>{e()}},[r])},y=e=>{const{id:t,eventRegistration:n}=e,{onPaymentSetup:r}=n,a=(0,o.getSetting)(t+"_data",{});c(a.helper_params).showPlaceOrderButton(),(0,m.useEffect)(()=>{const e=r(()=>{const e=document.getElementById("shipping-phone"),t=document.getElementById("billing-phone");return!(!e?.value&&!t?.value)||{type:"error",message:__("<strong>Phone</strong> is a required field for this payment method.","globalpayments-gateway-provider-for-woocommerce")}});return()=>{e()}},[r])},g=({state:e,helper:t,dispatchError:o,placeOrder:n})=>{var r;t.blockOnSubmit(),e.settings.helper_params.order=t.order;const a=e.tokenResponse?JSON.stringify(e.tokenResponse):null,s=null!==(r=document.querySelector(t.getStoredPaymentMethodsRadioSelector())?.value)&&void 0!==r?r:"new";return GlobalPayments.ThreeDSecure.checkVersion(e.threedsecure.checkEnrollmentUrl,{tokenResponse:a,wcTokenId:s,order:{id:e.settings.helper_params.order.id,amount:e.settings.helper_params.order.amount,currency:e.settings.helper_params.order.currency}}).then(r=>{if(r.error)return o(r.message),!1;if("NOT_ENROLLED"===r.status&&"YES"!==r.liabilityShift)return o("Please try again with another card."),!1;if("NOT_ENROLLED"===r.status&&"YES"===r.liabilityShift)return n(),!0;const i=!document.querySelector('.wc-block-checkout__use-address-for-billing input[type="checkbox"]')?.checked,l={streetAddress1:document.querySelector("#billing-address_1")?.value,streetAddress2:document.querySelector("#billing-address_2")?.value,city:document.querySelector("#billing-city")?.value,state:document.querySelector("#billing-state input")?.value,postalCode:document.querySelector("#billing-postcode")?.value,country:document.querySelector("#billing-country input")?.value},c=i?l:{streetAddress1:document.querySelector("#shipping-address_1")?.value,streetAddress2:document.querySelector("#shipping-address_2")?.value,city:document.querySelector("#shipping-city")?.value,state:document.querySelector("#shipping-state input")?.value,postalCode:document.querySelector("#shipping-postcode")?.value,country:document.querySelector("#shipping-country input")?.value};GlobalPayments.ThreeDSecure.initiateAuthentication(e.threedsecure.initiateAuthenticationUrl,{tokenResponse:a,wcTokenId:s,versionCheckData:r,challengeWindow:{windowSize:GlobalPayments.ThreeDSecure.ChallengeWindowSize.Windowed500x600,displayMode:"lightbox"},order:{id:e.settings.helper_params.order.id,amount:e.settings.helper_params.order.amount,currency:e.settings.helper_params.order.currency,billingAddress:l,shippingAddress:c,addressMatchIndicator:i,customerEmail:document.querySelector(".wc-block-components-address-form__email input#email").value}}).then(a=>{if(a.error)return o(a.message),!1;const s=a.serverTransactionId||a.challenge.response.data.threeDSServerTransID||r.serverTransactionId;return t.createInputElement(e.settings.id,"serverTransId",s),e.serverTransId=s,n(),!0}).catch(e=>(console.error(e),console.error(e.reasons),o("Something went wrong while doing 3DS processing."),!1))}).catch(e=>(console.error(e),console.error(e.reasons),o("Something went wrong while doing 3DS processing."),!1)),document.addEventListener("click",e=>{e.target.matches('img[id^="GlobalPayments-frame-close-"]')&&window.parent.postMessage({data:{transStatus:"N"},event:"challengeNotification"},window.location.origin)}),!1},h={settings:null,cardForm:null,tokenResponse:null,fieldOptions:null,serverTransId:null};let S={};const w=e=>{const{id:t,eventRegistration:r}=e,a=(0,o.getSetting)(t+"_data",{}),s=Object.entries(a.secure_payment_fields),{StoreNoticesContainer:i}=window.wc.blocksCheckout;S=c(a.helper_params),h.settings=a,h.fieldOptions=a.secure_payment_fields,h.threedsecure=a.threedsecure;const{onCheckoutFail:l}=r;return(0,m.useEffect)(()=>{f();const e=l(()=>{O(),E()});return()=>{document.querySelector(S.getPaymentMethodRadioSelector(h.settings.id))?.checked||(document.querySelector(S.getSubmitButtonTargetSelector(h.settings.id))?.remove(),S.showPlaceOrderButton()),e()}},[l]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:h.settings.environment_indicator}}),s.map(e=>(0,n.jsx)(b,{id:t,field:e[1]},e[0])),(0,n.jsx)(i,{context:"gp-wp-context"})]})},b=e=>{const{id:t,field:o}=e;return(0,n.jsxs)("div",{className:`globalpayments ${t} ${o.class}`,children:[(0,n.jsxs)("label",{htmlFor:`${t}-${o.class}`,children:[o.label,(0,n.jsx)("span",{className:"required",children:"*"})]}),(0,n.jsx)("div",{id:`${t}-${o.class}`})]})};var _=0,v=!1;const f=()=>{document.querySelector("#order_review, #add_payment_method")?.addEventListener("click",e=>{e.target.matches('#payment-method input[type="radio"]')&&S.toggleSubmitButtons()}),document.body.addEventListener("checkout_error",()=>{document.querySelector("#globalpayments_gpapi-serverTransId")?.remove()}),document.addEventListener("globalpayments_pay_order_modal_loaded",k),document.addEventListener("globalpayments_pay_order_modal_error",(e,t)=>{S.showPaymentError(t)});const e=()=>{k(),v||(setTimeout(()=>{v||k()},500),setTimeout(()=>{v||k()},1e3))};(S.isFirstPaymentMethod(h.settings.id)||S.isOnlyGatewayMethodDisplayed(h.settings.id))&&("loading"===document.readyState?(document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e)):"interactive"===document.readyState?(setTimeout(e,100),window.addEventListener("load",e)):e());const t=document.querySelector("#radio-control-wc-payment-method-options-globalpayments_gpapi"),o=()=>{console.log("Payment method changed to GlobalPayments"),v=!1,_=0,k()};t?t.addEventListener("change",o):setTimeout(()=>{const e=document.querySelector("#radio-control-wc-payment-method-options-globalpayments_gpapi");e&&e.addEventListener("change",o)},500)},k=()=>{if(v&&h.cardForm)return void console.log("GlobalPayments form is already initialized, skipping...");if(_>=20)return console.error("Maximum retry attempts reached. GlobalPayments form initialization failed."),void q("Payment form could not be loaded. Please refresh the page and try again.");const e=h.settings.gateway_options;e.error&&q(e.message),document.querySelector(S.getSubmitButtonTargetSelector(h.settings.id))||S.createSubmitButtonTarget(h.settings.id);const t=GlobalPayments;t.configure(e),t.on("error",C),h.cardForm=t.ui.form({fields:A(),styles:x()}),h.cardForm.on("submit","click",()=>{P(),T(),S.blockOnSubmit()}),h.cardForm.on("token-success",D),h.cardForm.on("token-error",C),h.cardForm.on("error",C),h.cardForm.on("card-form-validity",e=>{e||(S.unblockOnError(),E(),O())}),h.cardForm.ready(()=>{S.toggleSubmitButtons()})},P=()=>{const e=document.querySelector(S.getSubmitButtonTargetSelector(h.settings.id));e.classList.add("wc-block-components-spinner"),e.classList.add("wc-block-components-checkout-step--disabled"),e.style.height="initial !important",e.style.width="initial !important",e.style.position="relative"},E=()=>{const e=document.querySelector(S.getSubmitButtonTargetSelector(h.settings.id));e.classList.remove("wc-block-components-spinner"),e.classList.remove("wc-block-components-checkout-step--disabled"),e.style.height="initial !important",e.style.width="initial !important",e.style.position="relative"},T=()=>{document.querySelector(S.getFormSelector()).classList.add("wc-block-components-checkout-step--disabled"),document.querySelectorAll(`${S.getFormSelector()} > *`).forEach(e=>{e.style.pointerEvents="none"})},O=()=>{document.querySelector(S.getFormSelector()).classList.remove("wc-block-components-checkout-step--disabled"),document.querySelectorAll(`${S.getFormSelector()} > *`).forEach(e=>{e.style.pointerEvents=""})},q=e=>{S.dispatchError({message:e,cb:()=>{E(),O()}})},M=e=>{q(h.settings.secure_payment_fields[e].messages.validation),S.unblockOnError()},C=e=>{if(e.reasons)for(let t=0;t<e.reasons.length;t++){const o=e.reasons[t];"NOT_AUTHENTICATED"===o.code?q("We're not able to process this payment. Please refresh the page and try again."):q(o.message)}else q("Something went wrong. Please contact us to get assistance.")},A=()=>{const e={"card-number":{placeholder:h.fieldOptions["card-number-field"].placeholder,target:"#"+h.settings.id+"-"+h.fieldOptions["card-number-field"].class},"card-expiration":{placeholder:h.fieldOptions["card-expiry-field"].placeholder,target:"#"+h.settings.id+"-"+h.fieldOptions["card-expiry-field"].class},"card-cvv":{placeholder:h.fieldOptions["card-cvc-field"].placeholder,target:"#"+h.settings.id+"-"+h.fieldOptions["card-cvc-field"].class},submit:{text:B(),target:"#"+h.settings.id+"-card-submit"}};return h.fieldOptions.hasOwnProperty("card-holder-name-field")&&(e["card-holder-name"]={placeholder:h.fieldOptions["card-holder-name-field"].placeholder,target:"#"+h.settings.id+"-"+h.fieldOptions["card-holder-name-field"].class}),e},B=()=>document.querySelector(S.getPlaceOrderButtonSelector()).innerText,x=()=>JSON.parse(h.settings.field_styles),D=e=>{if(S.hasValidationErrors())return E(),O(),window.wp.data.dispatch(window.wc.wcBlocksData.VALIDATION_STORE_KEY).showAllValidationErrors(),void document.querySelector(".has-error")?.scrollIntoView({behavior:"smooth",block:"center",inline:"start"});N(e)&&(h.tokenResponse=e,L())},L=()=>{h.settings.gateway_options.enableThreeDSecure?(S.getOrderInfo(),g({state:h,helper:S,dispatchError:q,placeOrder:I})):I()},I=()=>{"function"==typeof h.cardForm.frames["card-cvv"].getCvv?h.cardForm.frames["card-cvv"].getCvv().then(e=>{h.tokenResponse&&(h.tokenResponse.details.cardSecurityCode=e),F()}):F()},N=e=>{if(e.details){const t=new Date(e.details.expiryYear,e.details.expiryMonth-1),o=new Date,n=new Date(o.getFullYear(),o.getMonth());if(!e.details.expiryYear||!e.details.expiryMonth||t<n)return M("card-expiry-field"),!1}return!(e.details&&!e.details.cardSecurityCode&&(M("card-cvc-field"),1))},F=()=>{const e={token_response:JSON.stringify(h.tokenResponse)};h.serverTransId&&(e.serverTransId=h.serverTransId),S.setPaymentMethodData(e),S.placeOrder()},{__:R}=wp.i18n,j={order:null,settings:null};let G={};const V=()=>{G.toggleSubmitButtons(),H()},H=()=>{G.createSubmitButtonTarget(j.settings.id);const e=document.createElement("div");e.className="apple-pay-button apple-pay-button-"+j.settings.payment_method_options.button_color,e.title=R("Pay with Apple Pay","globalpayments-gateway-provider-for-woocommerce"),e.alt=R("Pay with Apple Pay","globalpayments-gateway-provider-for-woocommerce"),e.id=j.settings.id,e.addEventListener("click",e=>{if(e.preventDefault(),G.hasValidationErrors())return window.wp.data.dispatch(window.wc.wcBlocksData.VALIDATION_STORE_KEY).showAllValidationErrors(),void document.querySelector(".has-error")?.scrollIntoView({behavior:"smooth",block:"center",inline:"start"});Y().begin()}),document.querySelector(G.getSubmitButtonTargetSelector(j.settings.id)).append(e)},Y=()=>{G.getOrderInfo(),j.order=G.order;let e=null;try{e=new ApplePaySession(1,U())}catch(e){return console.error(R("Unable to create ApplePaySession","globalpayments-gateway-provider-for-woocommerce"),e),alert(R("We're unable to take your payment through Apple Pay. Please try again or use an alternative payment method.","globalpayments-gateway-provider-for-woocommerce")),!1}return e.onvalidatemerchant=t=>{z(t,e)},e.onpaymentauthorized=t=>{K(t,e)},e.oncancel=e=>{alert(R("We're unable to take your payment through Apple Pay. Please try again or use an alternative payment method.","globalpayments-gateway-provider-for-woocommerce"))},e},U=()=>({countryCode:$(),currencyCode:j.order.currency,merchantCapabilities:["supports3DS"],supportedNetworks:W(),total:{label:J(),amount:j.order.amount.toString()},requiredBillingContactFields:["postalAddress","name"]}),$=()=>j.settings.payment_method_options.country_code,W=()=>j.settings.payment_method_options.cc_types,J=()=>j.settings.payment_method_options.apple_merchant_display_name,z=(e,t)=>{fetch(j.settings.payment_method_options.validate_merchant_url,{cache:"no-store",body:JSON.stringify({validationUrl:e.validationURL}),method:"POST"}).then(e=>e.json()).then(e=>{e.error?(console.log("response",e),t.abort(),alert(R("We're unable to take your payment through Apple Pay. Please try again or use an alternative payment method.","globalpayments-gateway-provider-for-woocommerce"))):t.completeMerchantValidation(JSON.parse(e.message))}).catch(e=>{console.log("response",e),t.abort(),alert(R("We're unable to take your payment through Apple Pay. Please try again or use an alternative payment method.","globalpayments-gateway-provider-for-woocommerce"))})},K=(e,t)=>{try{const o={dw_token:JSON.stringify(e.payment.token.paymentData)};e.payment.billingContact&&(o.cardHolderName=e.payment.billingContact.givenName+" "+e.payment.billingContact.familyName),G.setPaymentMethodData(o);const n=document.querySelector(G.getPlaceOrderButtonSelector());if(n)return n.click(),void t.completePayment(ApplePaySession.STATUS_SUCCESS)}catch(e){t.completePayment(ApplePaySession.STATUS_FAILURE)}t.completePayment(ApplePaySession.STATUS_SUCCESS),document.querySelector(G.getFormSelector()).submit()},{__:X}=wp.i18n,Q={order:null,ctpForm:null,settings:null};let Z={};const ee=()=>{if(Z.toggleSubmitButtons(),te(),!GlobalPayments.configure)return void console.log(X("Warning! Payment fields cannot be loaded","globalpayments-gateway-provider-for-woocommerce"));const e=Q.settings.payment_method_options;Z.getOrderInfo(),Q.order=Z.order,e.apms.currencyCode=Q.order.currency,GlobalPayments.configure(e),GlobalPayments.on("error",oe),Q.ctpForm=GlobalPayments.apm.form("#"+Q.settings.id,{amount:Q.order.amount.toString(),style:"gp-default",apms:[GlobalPayments.enums.Apm.ClickToPay]}),Q.ctpForm.on("token-success",ne),Q.ctpForm.on("token-error",oe),Q.ctpForm.on("error",oe)},te=()=>{const e=document.querySelector("#"+Q.settings.id);if(e?.children.length>0){for(;e.firstChild;)e.removeChild(e.lastChild);document.querySelector("#"+Q.settings.id+"-dw_token")?.remove()}},oe=e=>{console.error(e)},ne=e=>(Z.setPaymentMethodData({dw_token:e.paymentReference}),Z.placeOrder()),re={order:null,settings:null,paymentsClient:null};let ae={};const se=()=>{ie(),re.paymentsClient.isReadyToPay(ce()).then(e=>{e.result?ye(re.settings.id):(ae.hidePaymentMethod(re.settings.id),ae.hidePlaceOrderButton())}).catch(console.error)},ie=()=>{null===re.paymentsClient&&(re.paymentsClient=new google.payments.api.PaymentsClient({environment:le()}))},le=()=>re.settings.payment_method_options.env,ce=()=>Object.assign({},de(),{allowedPaymentMethods:[me()]}),de=()=>({apiVersion:2,apiVersionMinor:0}),me=()=>({type:"CARD",parameters:{allowedAuthMethods:pe(),allowedCardNetworks:ue(),billingAddressRequired:!0}}),pe=()=>re.settings.payment_method_options.aca_methods,ue=()=>re.settings.payment_method_options.cc_types,ye=()=>{ae.createSubmitButtonTarget(re.settings.id);const e=re.paymentsClient.createButton({buttonColor:ge(),onClick:()=>{he()}});document.querySelector(ae.getSubmitButtonTargetSelector(re.settings.id)).append(e)},ge=()=>re.settings.payment_method_options.button_color,he=()=>{if(ae.hasValidationErrors())return window.wp.data.dispatch(window.wc.wcBlocksData.VALIDATION_STORE_KEY).showAllValidationErrors(),void document.querySelector(".has-error")?.scrollIntoView({behavior:"smooth",block:"center",inline:"start"});ae.getOrderInfo(),re.order=ae.order;const e=Se();re.paymentsClient.loadPaymentData(e).then(e=>(ae.setPaymentMethodData({dw_token:JSON.stringify(JSON.parse(e.paymentMethodData.tokenizationData.token)),cardHolderName:e.paymentMethodData.info.billingAddress.name}),ae.placeOrder())).catch(console.error)},Se=()=>{const e=Object.assign({},de());return e.allowedPaymentMethods=[we()],e.transactionInfo=_e(),e.merchantInfo={merchantId:ve(),merchantName:fe()},e},we=()=>Object.assign({},me(),{tokenizationSpecification:be()}),be=()=>({type:"PAYMENT_GATEWAY",parameters:{gateway:"globalpayments",gatewayMerchantId:re.settings.payment_method_options.global_payments_merchant_id}}),_e=()=>({totalPriceStatus:"FINAL",totalPrice:re.order.amount.toString(),currencyCode:re.order.currency}),ve=()=>re.settings.payment_method_options.google_merchant_id,fe=()=>re.settings.payment_method_options.google_merchant_name,ke=()=>{j.settings=(0,o.getSetting)("globalpayments_applepay_data",{}),G=c(j.settings.helper_params),(0,m.useEffect)(()=>((G.isFirstPaymentMethod(j.settings.id)||G.isOnlyGatewayMethodDisplayed(j.settings.id))&&(window.onload=()=>{V()}),document.querySelector("#radio-control-wc-payment-method-options-globalpayments_applepay").addEventListener("change",V),()=>{document.querySelector(G.getPaymentMethodRadioSelector(j.settings.id))?.checked||(document.querySelector(G.getSubmitButtonTargetSelector(j.settings.id))?.remove(),G.toggleSubmitButtons())}))},Pe=()=>(Q.settings=(0,o.getSetting)("globalpayments_clicktopay_data",{}),Z=c(Q.settings.helper_params),(0,m.useEffect)(()=>((Z.isFirstPaymentMethod(Q.settings.id)||Z.isOnlyGatewayMethodDisplayed(Q.settings.id))&&(window.onload=()=>{ee()}),document.querySelector("#radio-control-wc-payment-method-options-globalpayments_clicktopay").addEventListener("change",ee),()=>{document.querySelector(Z.getPaymentMethodRadioSelector(Q.settings.id))?.checked||Z.toggleSubmitButtons()})),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{id:Q.settings.id})})),Ee=e=>{const{eventRegistration:t}=e;re.settings=(0,o.getSetting)("globalpayments_googlepay_data",{}),ae=c(re.settings.helper_params);const{onCheckoutFail:n}=t;(0,m.useEffect)(()=>{(ae.isFirstPaymentMethod(re.settings.id)||ae.isOnlyGatewayMethodDisplayed(re.settings.id))&&(window.onload=()=>{se()}),document.querySelector("#radio-control-wc-payment-method-options-globalpayments_googlepay").addEventListener("change",se);const e=n(()=>{document.querySelector(".is-error")?.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})});return()=>{document.querySelector(ae.getPaymentMethodRadioSelector(re.settings.id))?.checked||(document.querySelector(ae.getSubmitButtonTargetSelector(re.settings.id))?.remove(),ae.toggleSubmitButtons()),e()}},[n])},Te=({id:e})=>{const t=(0,o.getSetting)(e+"_data",{});c(t.helper_params).showPlaceOrderButton()},Oe=({id:e})=>{const t=(0,o.getSetting)(e+"_data",{});c(t.helper_params).showPlaceOrderButton()},qe={settings:null,onSubmit:null,serverTransId:""};let Me={};const Ce=e=>{const{id:t,onSubmit:r,eventRegistration:a}=e;qe.onSubmit=r;const s=(0,o.getSetting)(t+"_data",{});Me=c(s.helper_params),qe.settings=s,qe.threedsecure=s.threedsecure;const{onCheckoutFail:i}=a;(0,m.useEffect)(()=>{window.onload=()=>{Ae()};const e=i(()=>{xe(),Be()});return()=>{e()}},[i]);const{StoreNoticesContainer:l}=window.wc.blocksCheckout;return(0,n.jsx)(l,{context:"gp-wp-context"})},Ae=()=>{document.querySelector(Me.getPlaceOrderButtonSelector()).addEventListener("click",e=>{document.querySelector(Me.getStoredPaymentMethodsRadioSelector())&&(e.preventDefault(),e.stopImmediatePropagation(),Le())})},Be=()=>{document.querySelector("#wc-block-components-spinner")?.remove()},xe=()=>{document.querySelector(Me.getFormSelector()).classList.remove("wc-block-components-checkout-step--disabled"),document.querySelectorAll(`${Me.getFormSelector()} > *`).forEach(e=>{e.style.pointerEvents=""})},De=e=>{Me.dispatchError({message:e,cb:()=>{Be(),xe()}})},Le=()=>{if(Me.hasValidationErrors())return Be(),xe(),void document.querySelector(".has-error").scrollIntoView({behavior:"smooth",block:"center",inline:"start"});qe.settings.gateway_options.enableThreeDSecure?(Me.getOrderInfo(),(()=>{const e=document.querySelector(Me.getPlaceOrderButtonSelector()),t=document.createElement("span");t.id="wc-block-components-spinner",t.classList.add("wc-block-components-spinner"),e.appendChild(t)})(),document.querySelector(Me.getFormSelector()).classList.add("wc-block-components-checkout-step--disabled"),document.querySelectorAll(`${Me.getFormSelector()} > *`).forEach(e=>{e.style.pointerEvents="none"}),g({state:qe,helper:Me,dispatchError:De,placeOrder:()=>{const e=window.wp.data.select(window.wc.wcBlocksData.PAYMENT_STORE_KEY).getPaymentMethodData();e.serverTransId=qe.serverTransId,Me.setPaymentMethodData(e),qe.onSubmit()}})):qe.onSubmit()},{__:Ie}=wp.i18n,Ne=({billing:e,shippingData:t,setValidationErrors:o,clearValidationErrors:r,onSubmit:a,activePaymentMethod:s,eventRegistration:i,emitResponse:l,enableThreeDSecure:c,hpp_nonce:d,gateway_id:p,hpp_text:u,environment_indicator:y,...g})=>{const{onPaymentSetup:h,onCheckoutValidation:S}=i||{},w=(0,m.useMemo)(()=>e?.billingAddress?.country,[e?.billingAddress?.country]),b=(0,m.useMemo)(()=>t?.shippingAddress?.country,[t?.shippingAddress?.country]),_=(0,m.useMemo)(()=>"GB"===w||"GB"===b,[w,b]),v=(0,m.useMemo)(()=>({enableThreeDSecure:c,billingCountry:w,shippingCountry:b,isGBAddress:_,billingPhone:e?.billingAddress?.phone,billingState:e?.billingAddress?.state,shippingState:t?.shippingAddress?.state,needsShipping:t?.needsShipping}),[c,w,b,_,e?.billingAddress?.phone,e?.billingAddress?.state,t?.shippingAddress?.state,t?.needsShipping]);return(0,m.useEffect)(()=>{if(r)try{r()}catch(e){console.warn("GlobalPayments HPP: Failed to clear validation errors:",e)}},[r]),(0,m.useEffect)(()=>{const e=new Map,t='input[id*="phone"], input[name*="phone"]',o='input[name="radio-control-wc-payment-method-options"]',n=t=>{e.has(t)||e.set(t,{type:"innerHTML",value:t.innerHTML})},r=t=>{e.has(t)||n(t),(e=>{e.textContent.includes("(optional)")&&(e.innerHTML=e.innerHTML.replace(/\s*\(optional\)\s*/gi,"")),e.querySelectorAll("*").forEach(e=>{e.textContent.toLowerCase().includes("optional")&&(e.innerHTML=e.innerHTML.replace(/\s*\(optional\)\s*/gi,""))})})(t)},a=()=>{c&&document.querySelectorAll(t).forEach(e=>{((e,t)=>{if(!t)return;e.setAttribute("required","required"),e.setAttribute("aria-required","true"),document.querySelectorAll(`label[for="${e.id}"]`).forEach(e=>{r(e),(e=>{if(!e.querySelector(".gp-required-asterisk")){const t=document.createElement("span");t.className="gp-required-asterisk",t.textContent=" *",t.style.cssText="color: #e2401c; font-weight: bold;",e.appendChild(t)}})(e)});const o=e.id||e.name;if(o){const e=document.querySelector(`#validate-error-${o}`);e&&r(e)}let a=e.parentElement;for(;a&&!a.classList.contains("wc-block-checkout__form");)a.querySelectorAll(".wc-block-components-checkout-step__description").forEach(e=>{e.textContent.toLowerCase().includes("optional")&&(n(e),e.style.display="none")}),a=a.parentElement})(e,!0)})},s=()=>{e.forEach((e,t)=>{t&&t.parentNode&&("innerHTML"===e.type?t.innerHTML=e.value:"display"===e.type&&(t.style.display=e.value))}),e.clear(),document.querySelectorAll(`${t}`).forEach(e=>{e.removeAttribute("required"),e.removeAttribute("aria-required")}),document.querySelectorAll(".gp-required-asterisk").forEach(e=>{e.remove()})};a();const i=setTimeout(a,800),l=new MutationObserver(e=>{let n=!1;for(const r of e)if("childList"===r.type&&r.addedNodes.length>0)for(const e of r.addedNodes)e.nodeType===Node.ELEMENT_NODE&&e.querySelector&&(e.querySelector(`${t}`)&&(n=!0),e.querySelectorAll(o).forEach(e=>{e.addEventListener("change",d)}));n&&setTimeout(a,100)});l.observe(document.body,{childList:!0,subtree:!0});const d=e=>{let t;try{t=window.wp?.data?.select("wc/store/payment")?.getActivePaymentMethod()}catch(e){console.warn("GlobalPayments HPP: Payment Store access failed:",e)}const o=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked')?.value,n=t||o;n&&!n.includes("globalpayments")?s():setTimeout(a,100)},m=document.querySelectorAll(o);return m.forEach(e=>{e.addEventListener("change",d)}),()=>{clearTimeout(i),l.disconnect(),m.forEach(e=>{e.removeEventListener("change",d)}),s()}},[c,_]),(0,m.useEffect)(()=>{if(S)return S(()=>{const e=[];return v.enableThreeDSecure&&((v.billingPhone||"").trim()||e.push({errorId:"billing_phone_required",message:Ie("Billing phone number is required for secure payments.","globalpayments-gateway-provider-for-woocommerce"),validationErrorId:"billing_phone"})),!(e.length>0)||e})},[S,v]),(0,m.useEffect)(()=>h(()=>({type:l.responseTypes.SUCCESS,meta:{paymentMethodData:{payment_method:s||"globalpayments_gpapi",payment_interface:"hpp",gp_hpp_nonce:d||"",gateway_id:p||"globalpayments_gpapi",checkout_validated:"1"}}})),[h,l.responseTypes,d,p,s]),(0,n.jsxs)("div",{className:"gp-hpp-payment-method",children:[y&&(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:y}}),(0,n.jsx)("div",{className:"gp-hpp-description",children:(0,n.jsx)("p",{children:u||Ie("Pay With Credit / Debit Card Via Globalpayments","globalpayments-gateway-provider-for-woocommerce")})})]})};Ne.displayName="Globalpayments.HppComponent";const{__:Fe}=wp.i18n,Re=e=>{const t=(0,o.getSetting)("globalpayments_gpapi_data",{}),r=t.helper_params?.payment_interface||t.payment_interface,a=t.helper_params?.hpp_nonce||t.hpp_nonce,s=t.helper_params?.hpp_text||t.hpp_text,i=t.helper_params?.enableThreeDSecure||t.enableThreeDSecure;if("hpp"===r){const o={...e,hpp_nonce:a,hpp_text:s||Fe("Pay With Credit / Debit Card Via Globalpayments","globalpayments-gateway-provider-for-woocommerce"),gateway_id:"globalpayments_gpapi",payment_interface:"hpp",environment_indicator:t.environment_indicator||"",enableThreeDSecure:i||!1};return(0,n.jsx)(Ne,{...o})}return(0,n.jsx)(w,{id:"globalpayments_gpapi",...e})},je=[{id:"globalpayments_gpapi",Content:(0,n.jsx)(Re,{}),SavedTokenComponent:(0,n.jsx)(Ce,{id:"globalpayments_gpapi"}),canMakePayment:e=>!e.gateway_options.hide||!e.gateway_options.error||(console.error(e.gateway_options.message),!1)},{id:"globalpayments_clicktopay",Content:(0,n.jsx)(Pe,{}),SavedTokenComponent:null,canMakePayment:e=>!e.payment_method_options.error||(console.error(e.payment_method_options.message),!1)},{id:"globalpayments_googlepay",Content:(0,n.jsx)(Ee,{}),SavedTokenComponent:null,canMakePayment:()=>!0},{id:"globalpayments_applepay",Content:(0,n.jsx)(ke,{}),SavedTokenComponent:null,canMakePayment:()=>"https:"!==location.protocol?(console.warn(Fe("Apple Pay requires your checkout be served over HTTPS","globalpayments-gateway-provider-for-woocommerce")),!1):!0===(window.ApplePaySession&&ApplePaySession.canMakePayments())||(console.warn(Fe("Apple Pay is not supported on this device/browser","globalpayments-gateway-provider-for-woocommerce")),!1)},{id:"globalpayments_affirm",Content:(0,n.jsx)(u,{id:"globalpayments_affirm"}),SavedTokenComponent:null,canMakePayment:()=>!0},{id:"globalpayments_klarna",Content:(0,n.jsx)(y,{id:"globalpayments_klarna"}),SavedTokenComponent:null,canMakePayment:()=>!0},{id:"globalpayments_bankpayment",Content:(0,n.jsx)(Te,{id:"globalpayments_bankpayment"}),SavedTokenComponent:null,canMakePayment:()=>!0},{id:"globalpayments_paypal",Content:(0,n.jsx)(Oe,{id:"globalpayments_paypal"}),SavedTokenComponent:null,canMakePayment:()=>!0}],Ge=(0,e.getPaymentMethods)();je.forEach(r=>{Ge.hasOwnProperty(r.id)||(r=>{const{id:a,Content:s,SavedTokenComponent:i,canMakePayment:l}=r,c=(0,o.getSetting)(a+"_data",{});if(0===Object.entries(c).length)return;const d=(0,t.decodeEntities)(c.title),m=e=>{const{PaymentMethodLabel:t}=e.components;return(0,n.jsx)(t,{text:d})},p={name:a,label:(0,n.jsx)(m,{}),content:s,edit:s,savedTokenComponent:i,canMakePayment:()=>l(c),ariaLabel:d,supports:{features:c.supports,showSaveOption:c.allow_card_saving}};(0,e.registerPaymentMethod)(p)})(r)})})();